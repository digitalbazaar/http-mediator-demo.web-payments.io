<div ng-controller="hmdDemoController as model">

<h1 align="center">Payment Mediator Demo (HTTP API)</h1>

<p>
This site demonstrates a basic implementation of a payment mediator which can
be used to register payment apps, and route
<a href="http://w3c.github.io/webpayments/proposals/core-messages/#paymentrequest">payment request</a>s
and
<a href="http://w3c.github.io/webpayments/proposals/core-messages/#paymentresponse">payment response</a>s.
This demo is designed for non-interactive payments use cases. For example,
auto payment of utility bills, business-to-business payments, a car paying
for a parking spot (Internet of Things), etc. For more information, see the
<a href="http://w3c.github.io/webpayments/proposals/web-payments-http-api/">Web Payments HTTP API specification</a>.
</p>

<p>
The source for this demonstration can be found on Github under the
<a href="https://github.com/digitalbazaar/http-mediator-demo.web-payments.io">digitalbazaar/http-mediator-demo.web-payments.io</a>
project.
</p>

<p>
The steps below will guide you through the basic Web Payments HTTP API
ecosystem.
</p>

<h2>Step #1: Install Payment App</h2>

<p>
Before you can process payments, you must first install a payment app.<br/>
<button type="button" class="btn btn-primary" ng-click="model.registerPaymentApp()">Install Payment App</button>
</p>

<div class="panel panel-default" ng-hide="!(model.registrationRawRequest)">
  <div class="panel-heading">HTTP request
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
  </div>
  <div class="panel-body">
    <pre>{{model.registrationRawRequest}}</pre>
  </div>
</div>

<div class="panel panel-default" ng-hide="!(model.registrationRawResponse)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    HTTP response</div>
  <div class="panel-body">
    <pre>{{model.registrationRawResponse}}</pre>
  </div>
</div>

<div class="panel panel-default" ng-hide="!(model.paymentApp)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
    Payment App
  </div>
  <div class="panel-body">
    <div class="alert alert-success" style="text-align: center;" role="alert">
      <p class="lead">Payment App install successful!</p>
    </div>
    <pre>{{model.paymentApp|json}}</pre>
  </div>
</div>

<h2>Step #2: Perform a Purchase</h2>

<p>
To perform a purchase with your payment app, your software will:
</p>

<ol>
  <li>
Attempt to access payment-protected resource.
  </li>
  <li>
Retrieve a payment request from a merchant.
  </li>
  <li>
Process the payment request with your payment app.
  </li>
  <li>
Send the payment response to the merchant.
  </li>
</ol>

<button type="button" class="btn btn-primary" ng-disabled="!(model.enablePurchasing)" ng-click="model.performPurchase()">Perform a Purchase</button>

<h3 ng-hide="!(model.accessTargetPurchaseRawRequest)">
  Step 2.1: Attempt to access payment-protected resource.
</h3>
<div class="panel panel-default" ng-hide="!(model.accessTargetPurchaseRawRequest)">
  <div class="panel-heading">
    HTTP request
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
  </div>
  <div class="panel-body">
    <pre>{{model.accessTargetPurchaseRawRequest}}</pre>
  </div>
</div>
<div class="panel panel-default" ng-hide="!(model.accessTargetPurchaseRawResponse)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    HTTP response
  </div>
  <div class="panel-body">
    <pre>{{model.accessTargetPurchaseRawResponse}}</pre>
  </div>
</div>

<h3 ng-hide="!(model.paymentRequestRawRequest)">
  Step 2.2: Retrieve a payment request from a merchant.
</h3>
<div class="panel panel-default" ng-hide="!(model.paymentRequestRawRequest)">
  <div class="panel-heading">
    HTTP request
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
  </div>
  <div class="panel-body">
    <pre>{{model.paymentRequestRawRequest}}</pre>
  </div>
</div>
<div class="panel panel-default" ng-hide="!(model.paymentRequestRawResponse)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    HTTP response
  </div>
  <div class="panel-body">
    <pre>{{model.paymentRequestRawResponse}}</pre>
  </div>
</div>

<h3 ng-hide="!(model.paymentRequestPostRawRequest)">
  Step 2.3: Process the payment request with your payment app.
</h3>
<div class="panel panel-default" ng-hide="!(model.paymentRequestPostRawRequest)">
  <div class="panel-heading">
    HTTP request
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
  </div>
  <div class="panel-body">
    <pre>{{model.paymentRequestPostRawRequest}}</pre>
  </div>
</div>
<div class="panel panel-default" ng-hide="!(model.paymentRequestPostRawResponse)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    HTTP response
  </div>
  <div class="panel-body">
    <pre>{{model.paymentRequestPostRawResponse}}</pre>
  </div>
</div>

<h3 ng-hide="!(model.paymentResponsePostRawRequest)">
  Step 2.4: Send the payment response to the merchant.
</h3>
<div class="panel panel-default" ng-hide="!(model.paymentResponsePostRawRequest)">
  <div class="panel-heading">
    HTTP request
    <span class="glyphicon glyphicon-arrow-right" aria-hidden="true"></span>
  </div>
  <div class="panel-body">
    <pre>{{model.paymentResponsePostRawRequest}}</pre>
  </div>
</div>
<div class="panel panel-default" ng-hide="!(model.paymentResponsePostRawResponse)">
  <div class="panel-heading">
    <span class="glyphicon glyphicon-arrow-left" aria-hidden="true"></span>
    HTTP response
  </div>
  <div class="panel-body">
    <pre>{{model.paymentResponsePostRawResponse}}</pre>
  </div>
</div>

<div ng-hide="!(model.paymentSuccessful)" class="alert alert-success"
style="text-align: center;" role="alert">
  <p class="lead">
    <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
    &nbsp;&nbsp;&nbsp;
    Payment Successful!
    &nbsp;&nbsp;&nbsp;
    <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
</p>
</div>

</div>